resources:
  repositories:
    - repository: facet
      type: github
      endpoint: konst-int-i
      name: konst-int-i/facet
      ref: develop



trigger:
- master
- releases/*

pool:
  vmImage: 'ubuntu-latest'
strategy:
  matrix:
    Python35:
      python.version: '3.5'
    Python36:
      python.version: '3.6'
    Python37:
      python.version: '3.7'

steps:
- task: UsePythonVersion@0
  inputs:
    versionSpec: '$(python.version)'
  displayName: 'Use Python $(python.version)'

- checkout: self
- checkout: facet
- script: dir $(Build.SourcesDirectory)


- task: Bash@3
  inputs:
    targetType: 'inline'
    script: |
      eval "$(conda shell.bash hook)"
      cd /home/vsts/work/1/s/facet/
      conda env create -f environment.yml
      cd /home/vsts/work/1/s/pytools/
      pytest
  displayName: "Run pytest"

- script: |
    pip install pytest pytest-azurepipelines
    pytest test/
  displayName: 'Run pytest'